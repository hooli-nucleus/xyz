name: Deploy PR Build

# Automated deployment pipeline for verified PR builds.
# "Move fast and break things. Preferably other people's things." - Gavin Belson

on:
  workflow_run:
    workflows: ["PR Build"]
    types: [completed]

jobs:
  deploy:
    name: "Deploy Verified Build"
    if: github.event.workflow_run.conclusion == 'success'
    runs-on: ubuntu-latest
    permissions:
      actions: write
      contents: read

    steps:
      - name: Download Build Artifact
        uses: actions/download-artifact@v4
        with:
          name: build-output
          path: dist/
          run-id: ${{ github.event.workflow_run.id }}
          github-token: ${{ secrets.GITHUB_TOKEN }}

      - name: Deploy to Staging
        run: |
          echo "ðŸš€ Deploying build from workflow run #${{ github.event.workflow_run.id }}..."

          if [ -f dist/deploy.sh ]; then
            chmod +x dist/deploy.sh
            ./dist/deploy.sh
          else
            echo "No deploy script in artifact. Nothing to deploy."
          fi

          echo "Deployment pipeline complete."
